---
import { getCollection } from 'astro:content'

import AppLayout from '@/layouts/app-layout.astro';

import Hero from '@/components/home/hero.astro';
import ResourceCollection from '@/components/home/resource-collection.astro';
import RecentPosts from '@/components/home/recent-posts.astro';
import Newsletter from '@/components/newsletter.astro';

import { config } from '@/utils/config';
import { availableCollections } from '@/content/config';

const { title, description } = config;

const posts = (await getCollection(availableCollections.blog))
  .sort((a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf())
  .slice(0, 3);

const projects = (await getCollection(availableCollections.projects))
  .sort((a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf())
  .slice(0, 3);

const resources = (await getCollection(availableCollections.resources))
  .sort((a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf())
  .slice(0, 3);
---

<AppLayout head={{ title, description }}>
  <Hero />
  <ResourceCollection title="Recent" titleHighlight="projects" entries={projects} />
  <ResourceCollection title="Recent" titleHighlight="resources" entries={resources} />
  <RecentPosts posts={posts} />
  <Newsletter />
</AppLayout>
